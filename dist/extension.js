module.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}([function(e,t){e.exports=require("vscode")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(13),s=n(4),r=n(7),o=n(14);t.Source=class{constructor(e,t,n=0,i,s){this.name=e,this.path=t,this.sourceReference=n,i&&(this.origin=i),s&&(this.adapterData=s)}};t.Scope=class{constructor(e,t,n=!1){this.name=e,this.variablesReference=t,this.expensive=n}};t.StackFrame=class{constructor(e,t,n,i=0,s=0){this.id=e,this.source=n,this.line=i,this.column=s,this.name=t}};t.Thread=class{constructor(e,t){this.id=e,this.name=t||"Thread #"+e}};t.Variable=class{constructor(e,t,n=0,i,s){this.name=e,this.value=t,this.variablesReference=n,"number"==typeof s&&(this.namedVariables=s),"number"==typeof i&&(this.indexedVariables=i)}};t.Breakpoint=class{constructor(e,t,n,i){this.verified=e;const s=this;"number"==typeof t&&(s.line=t),"number"==typeof n&&(s.column=n),i&&(s.source=i)}};t.Module=class{constructor(e,t){this.id=e,this.name=t}};t.CompletionItem=class{constructor(e,t,n=0){this.label=e,this.start=t,this.length=n}};class a extends s.Event{constructor(e,t,n){super("stopped"),this.body={reason:e},"number"==typeof t&&(this.body.threadId=t),"string"==typeof n&&(this.body.text=n)}}t.StoppedEvent=a;class c extends s.Event{constructor(e,t){super("continued"),this.body={threadId:e},"boolean"==typeof t&&(this.body.allThreadsContinued=t)}}t.ContinuedEvent=c;class u extends s.Event{constructor(){super("initialized")}}t.InitializedEvent=u;class l extends s.Event{constructor(e){if(super("terminated"),"boolean"==typeof e||e){this.body={restart:e}}}}t.TerminatedEvent=l;class h extends s.Event{constructor(e,t="console",n){super("output"),this.body={category:t,output:e},void 0!==n&&(this.body.data=n)}}t.OutputEvent=h;class p extends s.Event{constructor(e,t){super("thread"),this.body={reason:e,threadId:t}}}t.ThreadEvent=p;class d extends s.Event{constructor(e,t){super("breakpoint"),this.body={reason:e,breakpoint:t}}}t.BreakpointEvent=d;class m extends s.Event{constructor(e,t){super("module"),this.body={reason:e,module:t}}}t.ModuleEvent=m;class g extends s.Event{constructor(e,t){super("loadedSource"),this.body={reason:e,source:t}}}t.LoadedSourceEvent=g;class b extends s.Event{constructor(e){super("capabilities"),this.body={capabilities:e}}}var f;t.CapabilitiesEvent=b,function(e){e[e.User=1]="User",e[e.Telemetry=2]="Telemetry"}(f=t.ErrorDestination||(t.ErrorDestination={}));class v extends i.ProtocolServer{constructor(e,t){super();const n="boolean"==typeof e&&e;this._debuggerLinesStartAt1=n,this._debuggerColumnsStartAt1=n,this._debuggerPathsAreURIs=!1,this._clientLinesStartAt1=!0,this._clientColumnsStartAt1=!0,this._clientPathsAreURIs=!1,this._isServer="boolean"==typeof t&&t,this.on("close",()=>{this.shutdown()}),this.on("error",e=>{this.shutdown()})}setDebuggerPathFormat(e){this._debuggerPathsAreURIs="path"!==e}setDebuggerLinesStartAt1(e){this._debuggerLinesStartAt1=e}setDebuggerColumnsStartAt1(e){this._debuggerColumnsStartAt1=e}setRunAsServer(e){this._isServer=e}static run(e){let t=0;if(process.argv.slice(2).forEach((function(e,n,i){const s=/^--server=(\d{4,5})$/.exec(e);s&&(t=parseInt(s[1],10))})),t>0)console.error(`waiting for debug protocol on port ${t}`),r.createServer(t=>{console.error(">> accepted connection from client"),t.on("end",()=>{console.error(">> client connection closed\n")});const n=new e(!1,!0);n.setRunAsServer(!0),n.start(t,t)}).listen(t);else{const t=new e(!1);process.on("SIGTERM",()=>{t.shutdown()}),t.start(process.stdin,process.stdout)}}shutdown(){this._isServer||this._isRunningInline()||setTimeout(()=>{process.exit(0)},100)}sendErrorResponse(e,t,n,i,s=f.User){let r;"number"==typeof t?(r={id:t,format:n},i&&(r.variables=i),s&f.User&&(r.showUser=!0),s&f.Telemetry&&(r.sendTelemetry=!0)):r=t,e.success=!1,e.message=v.formatPII(r.format,!0,r.variables),e.body||(e.body={}),e.body.error=r,this.sendResponse(e)}runInTerminalRequest(e,t,n){this.sendRequest("runInTerminal",e,t,n)}dispatchRequest(e){const t=new s.Response(e);try{if("initialize"===e.command){var n=e.arguments;if("boolean"==typeof n.linesStartAt1&&(this._clientLinesStartAt1=n.linesStartAt1),"boolean"==typeof n.columnsStartAt1&&(this._clientColumnsStartAt1=n.columnsStartAt1),"path"!==n.pathFormat)this.sendErrorResponse(t,2018,"debug adapter only supports native paths",null,f.Telemetry);else{const e=t;e.body={},this.initializeRequest(e,n)}}else"launch"===e.command?this.launchRequest(t,e.arguments,e):"attach"===e.command?this.attachRequest(t,e.arguments,e):"disconnect"===e.command?this.disconnectRequest(t,e.arguments,e):"terminate"===e.command?this.terminateRequest(t,e.arguments,e):"restart"===e.command?this.restartRequest(t,e.arguments,e):"setBreakpoints"===e.command?this.setBreakPointsRequest(t,e.arguments,e):"setFunctionBreakpoints"===e.command?this.setFunctionBreakPointsRequest(t,e.arguments,e):"setExceptionBreakpoints"===e.command?this.setExceptionBreakPointsRequest(t,e.arguments,e):"configurationDone"===e.command?this.configurationDoneRequest(t,e.arguments,e):"continue"===e.command?this.continueRequest(t,e.arguments,e):"next"===e.command?this.nextRequest(t,e.arguments,e):"stepIn"===e.command?this.stepInRequest(t,e.arguments,e):"stepOut"===e.command?this.stepOutRequest(t,e.arguments,e):"stepBack"===e.command?this.stepBackRequest(t,e.arguments,e):"reverseContinue"===e.command?this.reverseContinueRequest(t,e.arguments,e):"restartFrame"===e.command?this.restartFrameRequest(t,e.arguments,e):"goto"===e.command?this.gotoRequest(t,e.arguments,e):"pause"===e.command?this.pauseRequest(t,e.arguments,e):"stackTrace"===e.command?this.stackTraceRequest(t,e.arguments,e):"scopes"===e.command?this.scopesRequest(t,e.arguments,e):"variables"===e.command?this.variablesRequest(t,e.arguments,e):"setVariable"===e.command?this.setVariableRequest(t,e.arguments,e):"setExpression"===e.command?this.setExpressionRequest(t,e.arguments,e):"source"===e.command?this.sourceRequest(t,e.arguments,e):"threads"===e.command?this.threadsRequest(t,e):"terminateThreads"===e.command?this.terminateThreadsRequest(t,e.arguments,e):"evaluate"===e.command?this.evaluateRequest(t,e.arguments,e):"stepInTargets"===e.command?this.stepInTargetsRequest(t,e.arguments,e):"gotoTargets"===e.command?this.gotoTargetsRequest(t,e.arguments,e):"completions"===e.command?this.completionsRequest(t,e.arguments,e):"exceptionInfo"===e.command?this.exceptionInfoRequest(t,e.arguments,e):"loadedSources"===e.command?this.loadedSourcesRequest(t,e.arguments,e):"dataBreakpointInfo"===e.command?this.dataBreakpointInfoRequest(t,e.arguments,e):"setDataBreakpoints"===e.command?this.setDataBreakpointsRequest(t,e.arguments,e):"readMemory"===e.command?this.readMemoryRequest(t,e.arguments,e):"disassemble"===e.command?this.disassembleRequest(t,e.arguments,e):"cancel"===e.command?this.cancelRequest(t,e.arguments,e):"breakpointLocations"===e.command?this.breakpointLocationsRequest(t,e.arguments,e):this.customRequest(e.command,t,e.arguments,e)}catch(e){this.sendErrorResponse(t,1104,"{_stack}",{_exception:e.message,_stack:e.stack},f.Telemetry)}}initializeRequest(e,t){e.body.supportsConditionalBreakpoints=!1,e.body.supportsHitConditionalBreakpoints=!1,e.body.supportsFunctionBreakpoints=!1,e.body.supportsConfigurationDoneRequest=!0,e.body.supportsEvaluateForHovers=!1,e.body.supportsStepBack=!1,e.body.supportsSetVariable=!1,e.body.supportsRestartFrame=!1,e.body.supportsStepInTargetsRequest=!1,e.body.supportsGotoTargetsRequest=!1,e.body.supportsCompletionsRequest=!1,e.body.supportsRestartRequest=!1,e.body.supportsExceptionOptions=!1,e.body.supportsValueFormattingOptions=!1,e.body.supportsExceptionInfoRequest=!1,e.body.supportTerminateDebuggee=!1,e.body.supportsDelayedStackTraceLoading=!1,e.body.supportsLoadedSourcesRequest=!1,e.body.supportsLogPoints=!1,e.body.supportsTerminateThreadsRequest=!1,e.body.supportsSetExpression=!1,e.body.supportsTerminateRequest=!1,e.body.supportsDataBreakpoints=!1,e.body.supportsReadMemoryRequest=!1,e.body.supportsDisassembleRequest=!1,e.body.supportsCancelRequest=!1,e.body.supportsBreakpointLocationsRequest=!1,this.sendResponse(e)}disconnectRequest(e,t,n){this.sendResponse(e),this.shutdown()}launchRequest(e,t,n){this.sendResponse(e)}attachRequest(e,t,n){this.sendResponse(e)}terminateRequest(e,t,n){this.sendResponse(e)}restartRequest(e,t,n){this.sendResponse(e)}setBreakPointsRequest(e,t,n){this.sendResponse(e)}setFunctionBreakPointsRequest(e,t,n){this.sendResponse(e)}setExceptionBreakPointsRequest(e,t,n){this.sendResponse(e)}configurationDoneRequest(e,t,n){this.sendResponse(e)}continueRequest(e,t,n){this.sendResponse(e)}nextRequest(e,t,n){this.sendResponse(e)}stepInRequest(e,t,n){this.sendResponse(e)}stepOutRequest(e,t,n){this.sendResponse(e)}stepBackRequest(e,t,n){this.sendResponse(e)}reverseContinueRequest(e,t,n){this.sendResponse(e)}restartFrameRequest(e,t,n){this.sendResponse(e)}gotoRequest(e,t,n){this.sendResponse(e)}pauseRequest(e,t,n){this.sendResponse(e)}sourceRequest(e,t,n){this.sendResponse(e)}threadsRequest(e,t){this.sendResponse(e)}terminateThreadsRequest(e,t,n){this.sendResponse(e)}stackTraceRequest(e,t,n){this.sendResponse(e)}scopesRequest(e,t,n){this.sendResponse(e)}variablesRequest(e,t,n){this.sendResponse(e)}setVariableRequest(e,t,n){this.sendResponse(e)}setExpressionRequest(e,t,n){this.sendResponse(e)}evaluateRequest(e,t,n){this.sendResponse(e)}stepInTargetsRequest(e,t,n){this.sendResponse(e)}gotoTargetsRequest(e,t,n){this.sendResponse(e)}completionsRequest(e,t,n){this.sendResponse(e)}exceptionInfoRequest(e,t,n){this.sendResponse(e)}loadedSourcesRequest(e,t,n){this.sendResponse(e)}dataBreakpointInfoRequest(e,t,n){this.sendResponse(e)}setDataBreakpointsRequest(e,t,n){this.sendResponse(e)}readMemoryRequest(e,t,n){this.sendResponse(e)}disassembleRequest(e,t,n){this.sendResponse(e)}cancelRequest(e,t,n){this.sendResponse(e)}breakpointLocationsRequest(e,t,n){this.sendResponse(e)}customRequest(e,t,n,i){this.sendErrorResponse(t,1014,"unrecognized request",null,f.Telemetry)}convertClientLineToDebugger(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e+1:this._clientLinesStartAt1?e-1:e}convertDebuggerLineToClient(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e-1:this._clientLinesStartAt1?e+1:e}convertClientColumnToDebugger(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e+1:this._clientColumnsStartAt1?e-1:e}convertDebuggerColumnToClient(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e-1:this._clientColumnsStartAt1?e+1:e}convertClientPathToDebugger(e){return this._clientPathsAreURIs!==this._debuggerPathsAreURIs?this._clientPathsAreURIs?v.uri2path(e):v.path2uri(e):e}convertDebuggerPathToClient(e){return this._debuggerPathsAreURIs!==this._clientPathsAreURIs?this._debuggerPathsAreURIs?v.uri2path(e):v.path2uri(e):e}static path2uri(e){"win32"===process.platform&&(/^[A-Z]:/.test(e)&&(e=e[0].toLowerCase()+e.substr(1)),e=e.replace(/\\/g,"/")),e=encodeURI(e);let t=new o.URL("file:");return t.pathname=e,t.toString()}static uri2path(e){let t=new o.URL(e),n=decodeURIComponent(t.pathname);return"win32"===process.platform&&(/^\/[a-zA-Z]:/.test(n)&&(n=n[1].toLowerCase()+n.substr(2)),n=n.replace(/\//g,"\\")),n}static formatPII(e,t,n){return e.replace(v._formatPIIRegexp,(function(e,i){return t&&i.length>0&&"_"!==i[0]?e:n[i]&&n.hasOwnProperty(i)?n[i]:e}))}}v._formatPIIRegexp=/{([^}]+)}/g,t.DebugSession=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e){this.seq=0,this.type=e}}t.Message=i;t.Response=class extends i{constructor(e,t){super("response"),this.request_seq=e.seq,this.command=e.command,t?(this.success=!1,this.message=t):this.success=!0}};t.Event=class extends i{constructor(e,t){super("event"),this.event=e,t&&(this.body=t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),s=n(21),r=n(22),o={};t.definitions=o;function a(e){return/\s+/.test(e)}function c(e){return e?e.substring(1):e}function u(e,t){let n=t?"":",";return n+=e.name,n+=":"+e.type,e.optional&&(n="["+n+"]"),n}function l(e,t){o[e]?o[e].push(t):o[e]=[t]}t.MumpsToken=class{constructor(e,t){this.document=e,this.position=t,this.range=e.getWordRangeAtPosition(t),this.range&&(this.word=e.getText(this.range),this.word&&(this.surroundWord=function(e,t){if(t.start.character<=0)return;let n=new i.Position(t.start.line,t.start.character-1),s=new i.Position(t.end.line,t.end.character+1),r=e.getText(new i.Range(n,s));if("$"===r.charAt(0)){n=new i.Position(n.line,n.character-1);let t=e.getText(new i.Range(n,s));"$"===t.charAt(0)&&(r=t)}return r}(e,this.range)||this.word,this.isIntrinsic&&(this.word="$"+this.word)))}get mayBeCommand(){if(!this.surroundWord)return!1;let e=this.surroundWord.charAt(this.surroundWord.length-1);return(a(this.surroundWord.charAt(0))||"."===this.surroundWord.charAt(0))&&(":"===e||a(e)||this.surroundWord.length===this.word.length+1)}get isIntrinsic(){return!!this.surroundWord&&("$"===this.surroundWord.charAt(0)&&"$"!==this.surroundWord.charAt(1))}get isFunctionCall(){return!!this.surroundWord&&"("===this.surroundWord.charAt(this.surroundWord.length-1)}get isLabelReference(){if(void 0===this._isLabelReference){let e=this.document.lineAt(this.range.start),t=this.isIntrinsic?this.word.substring(1):this.word,n=new RegExp("(([ \t](D|DO|G|GOTO)[ \t]+)|\\$\\$)([%\\^\\+A-Z0-9]*"+t+"[%\\^\\+A-Z0-9]*)","i").exec(e.text);if(this._isLabelReference=null!==n,n){let e=n[4],t=/([%A-Z][%A-Z0-9]*)?(\+\d+)?(\^[%A-Z][%A-Z0-9]*)?/gi.exec(e);t&&(this.label=t[1],this.labelOffset=Number(c(t[2])),this.labelProgram=c(t[3])),this.referredToLabel=s.lookupLabelReference(this)}}return this._isLabelReference}get definition(){if(void 0===this._definition){this._definition=!1;let e=o[this.word.toUpperCase()];if(e){for(let t of e)if(!this.isFunctionCall||"function"===t.type){this._definition=t;break}}else this.isLabelReference&&(this._definition=s.createDefinitionForLabelReference(this.referredToLabel));this._definition&&"function"===this._definition.type&&(this._definition.functionSignature=function(e){let t=e.name+"(";if(e.parameters)for(let n=0;n<e.parameters.length;n++)t+=u(e.parameters[n],0===n);t+=")",e.returns&&(t+=":"+e.returns.type);return t}(this._definition))}return this._definition}};for(let e of r)l(e.name,e),e.abbreviation&&l(e.abbreviation,e)},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("net")},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){e.done?s(e.value):new n((function(t){t(e.value)})).then(o,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(2),o=n(16),a=n(3);var c;!function(e){e[e.Verbose=0]="Verbose",e[e.Log=1]="Log",e[e.Warn=2]="Warn",e[e.Error=3]="Error",e[e.Stop=4]="Stop"}(c=t.LogLevel||(t.LogLevel={}));class u{constructor(){this._pendingLogQ=[]}log(e,t=c.Log){e+="\n",this._write(e,t)}verbose(e){this.log(e,c.Verbose)}warn(e){this.log(e,c.Warn)}error(e){this.log(e,c.Error)}dispose(){if(this._currentLogger){const e=this._currentLogger.dispose();return this._currentLogger=null,e}return Promise.resolve()}_write(e,t=c.Log){e+="",this._pendingLogQ?this._pendingLogQ.push({msg:e,level:t}):this._currentLogger&&this._currentLogger.log(e,t)}setup(e,t,n=!0){const i="string"==typeof t?t:t&&this._logFilePathFromInit;if(this._currentLogger){const t={consoleMinLogLevel:e,logFilePath:i,prependTimestamp:n};this._currentLogger.setup(t).then(()=>{if(this._pendingLogQ){const e=this._pendingLogQ;this._pendingLogQ=null,e.forEach(e=>this._write(e.msg,e.level))}})}}init(e,t,n){this._pendingLogQ=this._pendingLogQ||[],this._currentLogger=new l(e,n),this._logFilePathFromInit=t}}t.Logger=u,t.logger=new u;class l{constructor(e,t){this.beforeExitCallback=()=>this.dispose(),this._logCallback=e,this._logToConsole=t,this._minLogLevel=c.Warn,this.disposeCallback=(e,t)=>{this.dispose(),t=t||2,t+=128,process.exit(t)}}setup(e){return i(this,void 0,void 0,(function*(){if(this._minLogLevel=e.consoleMinLogLevel,this._prependTimestamp=e.prependTimestamp,e.logFilePath)if(r.isAbsolute(e.logFilePath)){const n=t=>this.sendLog(`Error creating log file at path: ${e.logFilePath}. Error: ${t.toString()}\n`,c.Error);try{yield(t=r.dirname(e.logFilePath),new Promise((e,n)=>{o(t,t=>{t?n(t):e()})})),this.log("Verbose logs are written to:\n",c.Warn),this.log(e.logFilePath+"\n",c.Warn),this._logFileStream=s.createWriteStream(e.logFilePath),this.logDateTime(),this.setupShutdownListeners(),this._logFileStream.on("error",e=>{n(e)})}catch(e){n(e)}}else this.log(`logFilePath must be an absolute path: ${e.logFilePath}`,c.Error);var t}))}logDateTime(){let e=new Date;const t=e.getUTCFullYear()+"-"+`${e.getUTCMonth()+1}`+"-"+e.getUTCDate()+", "+d();this.log(t+"\n",c.Verbose,!1)}setupShutdownListeners(){process.addListener("beforeExit",this.beforeExitCallback),process.addListener("SIGTERM",this.disposeCallback),process.addListener("SIGINT",this.disposeCallback)}removeShutdownListeners(){process.removeListener("beforeExit",this.beforeExitCallback),process.removeListener("SIGTERM",this.disposeCallback),process.removeListener("SIGINT",this.disposeCallback)}dispose(){return new Promise(e=>{this.removeShutdownListeners(),this._logFileStream?(this._logFileStream.end(e),this._logFileStream=null):e()})}log(e,t,n=!0){if(this._minLogLevel!==c.Stop){if(t>=this._minLogLevel&&this.sendLog(e,t),this._logToConsole){const n=t===c.Error?console.error:t===c.Warn?console.warn:null;n&&n(p(e))}t===c.Error&&(e=`[${c[t]}] ${e}`),this._prependTimestamp&&n&&(e="["+d()+"] "+e),this._logFileStream&&this._logFileStream.write(e)}}sendLog(e,t){if(e.length>1500){const t=!!e.match(/(\n|\r\n)$/);e=e.substr(0,1500)+"[...]",t&&(e+="\n")}if(this._logCallback){const n=new h(e,t);this._logCallback(n)}}}class h extends a.OutputEvent{constructor(e,t){super(e,t===c.Error?"stderr":t===c.Warn?"console":"stdout")}}function p(e){return e.replace(/(\n|\r\n)$/,"")}function d(){let e=new Date;return m(2,String(e.getUTCHours()))+":"+m(2,String(e.getUTCMinutes()))+":"+m(2,String(e.getUTCSeconds()))+"."+m(3,String(e.getUTCMilliseconds()))+" UTC"}function m(e,t){return t.length>=e?t:String("0".repeat(e)+t).slice(-e)}t.LogOutputEvent=h,t.trimLastNewline=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);function s(e){return 0!==e.length&&" "!==e.charAt(0)&&"\t"!==e.charAt(0)&&";"!==e.charAt(0)}function r(e){let t="";t+="\t;****************\n",t+="\t; DESCRIPTION: \n";let n=e.match(/\(.*\)/);return null!==n&&n.length>0&&(n=n[0].substring(1,n[0].length-1).split(","),n.length>0&&(t+="\t; PARAMETERS: \n",n.forEach((function(e){t+="\t;    "+e+"(I/O,REQ): \n"})))),t+="\t; RETURNS: \n",t+="\t; REVISIONS: \n",t+="\t;****************\n",t}t.DocumentFunction=function(){let e=i.window.activeTextEditor;if(e){let t=e.document,n=e.selection.start.with(e.selection.start.line,0);for(;n.line<t.lineCount;){if(""!==e.document.lineAt(n.line).text.replace(/\t|\ /i,""))break;n=n.translate(1,0)}for(n.line===t.lineCount&&(n=n.translate(-1,0));n.line>=0;){let t=e.document.lineAt(n.line).text;if(s(t)){e.edit(e=>{e.insert(n,r(t))});break}n=n.translate(-1,0)}}},t.getSigInfo=function(e,t,n){if(e.text){let i=e.text.match(/DESCRIPTION:.*/i);null!==i&&(t.description=i[0]);for(let t in n){let i=e.text.match(new RegExp(t+"\\(.*\\):.*","i"));null!==i&&(n[t].description=i)}}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){e.done?s(e.value):new n((function(t){t(e.value)})).then(o,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),r=n(11),o=n(20),a=n(23),c=n(24),u=n(9),l=n(25),h=n(28);t.activate=function(e){return i(this,void 0,void 0,(function*(){const t={language:"mumps",scheme:"file"},n=s.languages.createDiagnosticCollection("mumps");e.subscriptions.push(s.commands.registerCommand("mumps.getEntryRef",()=>s.window.showInputBox({placeHolder:"Please enter the Entry-Reference to start Debugging",value:""}))),e.subscriptions.push(n,s.commands.registerCommand("mumps.documentFunction",()=>{u.DocumentFunction()}),s.commands.registerCommand("mumps.autoSpaceEnter",()=>{h.autoSpaceEnter()}),s.commands.registerCommand("mumps.autoSpaceTab",()=>{h.autoSpaceTab()}),s.languages.registerHoverProvider(t,new o.MumpsHoverProvider),s.languages.registerDefinitionProvider(t,new a.MumpsDefinitionProvider),s.languages.registerSignatureHelpProvider(t,new c.MumpsSignatureHelpProvider,"(",","),s.languages.registerDocumentSymbolProvider(t,new l.MumpsDocumentSymbolProvider),s.languages.registerDocumentFormattingEditProvider(t,{provideDocumentFormattingEdits:(e,t,n)=>{let i=[];for(let t=0;t<e.lineCount;t++){m(e.lineAt(t).text,t,i)}return i}}),s.languages.registerDocumentRangeFormattingEditProvider(t,{provideDocumentRangeFormattingEdits:(e,t,n,i)=>{let s=[];for(let n=t.start.line;n<=t.end.line;n++){m(e.lineAt(n).text,n,s)}return s}}),s.debug.registerDebugConfigurationProvider("mumps",new p),s.debug.registerDebugAdapterDescriptorFactory("mumps",new d)),s.languages.registerEvaluatableExpressionProvider(t,{provideEvaluatableExpression(e,t){const i=n.get(e.uri);if(i){if(i.find(e=>e.range.contains(t)))return}const r=e.lineAt(t.line).text;let o=/([ (,+\-\*_:=])(\^?%?[a-zA-Z][a-zA-Z\d]*(\(.[^\)]+\))?)/g;")"!==r.substring(t.character,t.character+1)&&(o=/([ (,+\-\*_:=])(\^?%?[a-zA-Z][a-zA-Z\d]*)/g);let a=null;for(;a=o.exec(r);){let e=a.index;e+=a[0].length-a[2].length;let n=e+a[2].length-1;if(e<=t.character&&n>=t.character)return new s.EvaluatableExpression(new s.Range(t.line,e,t.line,n),a[2])}}})}))},t.deactivate=function(){};class p{resolveDebugConfiguration(e,t,n){if(!t.type&&!t.request&&!t.name){const e=s.window.activeTextEditor;e&&"mumps"===e.document.languageId&&(t.type="mumps",t.name="Launch",t.request="launch",t.program="${file}",t.stopOnEntry=!0,t.hostname="127.0.0.1",t.localRoutinesPath="y:\\",t.port=9e3)}return t.program?t:s.window.showInformationMessage("Cannot find a program to debug").then(e=>{})}}class d{createDebugAdapterDescriptor(e){return new s.DebugAdapterInlineImplementation(new r.MumpsDebugSession)}}function m(e,t,n){if(0===e.replace(/(\ |\t)/gi,"").length&&n.push(s.TextEdit.insert(new s.Position(t,0),"\t;")),e.endsWith(". ")?n.push(s.TextEdit.insert(new s.Position(t,e.length),";")):e.endsWith(".")&&n.push(s.TextEdit.insert(new s.Position(t,e.length)," ;")),e.startsWith(" ")){let i;for(i=0;i<e.length&&" "===e.charAt(i);i++);n.push(s.TextEdit.replace(new s.Range(new s.Position(t,0),new s.Position(t,i)),"\t"))}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){e.done?s(e.value):new n((function(t){t(e.value)})).then(o,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=n(12),r=n(2),{Subject:o}=n(18),a=n(19),c=n(0),u=n(1),l=c.languages.createDiagnosticCollection("mumps");class h extends s.LoggingDebugSession{constructor(){super(),this._variableHandles=new s.Handles,this._configurationDone=new o,this.setDebuggerLinesStartAt1(!1),this.setDebuggerColumnsStartAt1(!1),this._program="",this._mconnect=new a.MConnect,this._mconnect.on("stopOnEntry",()=>{this.sendEvent(new s.StoppedEvent("entry",h.THREAD_ID))}),this._mconnect.on("stopOnStep",()=>{this.sendEvent(new s.StoppedEvent("step",h.THREAD_ID))}),this._mconnect.on("stopOnBreakpoint",()=>{this.sendEvent(new s.StoppedEvent("breakpoint",h.THREAD_ID))}),this._mconnect.on("stopOnDataBreakpoint",()=>{this.sendEvent(new s.StoppedEvent("data breakpoint",h.THREAD_ID))}),this._mconnect.on("stopOnException",e=>{this.sendEvent(new s.StoppedEvent("exception",h.THREAD_ID,e))}),this._mconnect.on("breakpointValidated",e=>{this.sendEvent(new s.BreakpointEvent("changed",{verified:e.verified,id:e.id}))}),this._mconnect.on("output",(e,t,n,i)=>{const r=new s.OutputEvent(`${e}\n`);r.body.source=this.createSource(t),r.body.line=this.convertDebuggerLineToClient(n),r.body.column=this.convertDebuggerColumnToClient(i),this.sendEvent(r)}),this._mconnect.on("end",()=>{this.sendEvent(new s.TerminatedEvent)})}initializeRequest(e,t){e.body=e.body||{},e.body.supportsConfigurationDoneRequest=!0,e.body.supportsEvaluateForHovers=!0,e.body.supportsDataBreakpoints=!1,e.body.supportsCompletionsRequest=!1,e.body.completionTriggerCharacters=[".","["],e.body.supportsCancelRequest=!1,e.body.supportsBreakpointLocationsRequest=!0,e.body.supportsExceptionInfoRequest=!0,e.body.supportsRestartRequest=!0,this.sendResponse(e),this.sendEvent(new s.InitializedEvent)}configurationDoneRequest(e,t){super.configurationDoneRequest(e,t),this._configurationDone.notify()}launchRequest(e,t){return i(this,void 0,void 0,(function*(){s.logger.setup(t.trace?s.Logger.LogLevel.Verbose:s.Logger.LogLevel.Stop,!1),yield this._configurationDone.wait(1e3),this._mconnect.init(t.hostname,t.port,t.localRoutinesPath).then(()=>i(this,void 0,void 0,(function*(){this.refreshDiagnostics(c.window.activeTextEditor.document,l),this._mconnect.start(t.program,!!t.stopOnEntry),this._program=t.program,this.sendResponse(e)}))).catch(e=>{c.window.showErrorMessage("Connection to MDEBUG failed. \nPlease start MDEBUG first.")})}))}setBreakPointsRequest(e,t){const n=t.source.path,i=t.lines||[];this._mconnect.clearBreakpoints(n);const r=i.map(e=>{let{verified:t,line:i,id:r}=this._mconnect.setBreakPoint(n,this.convertClientLineToDebugger(e));const o=new s.Breakpoint(t,this.convertDebuggerLineToClient(i));return o.id=r,o});e.body={breakpoints:r},this.sendResponse(e),this._mconnect.requestBreakpoints()}threadsRequest(e){e.body={threads:[new s.Thread(h.THREAD_ID,"thread 1")]},this.sendResponse(e)}stackTraceRequest(e,t){const n="number"==typeof t.startFrame?t.startFrame:0,i=n+("number"==typeof t.levels?t.levels:1e3),r=this._mconnect.stack(n,i);e.body={stackFrames:r.frames.map(e=>new s.StackFrame(e.index,e.name,this.createSource(e.file),this.convertDebuggerLineToClient(e.line))),totalFrames:r.count},this.sendResponse(e)}scopesRequest(e,t){e.body={scopes:[new s.Scope("Local",this._variableHandles.create("local|0"),!0),new s.Scope("System",this._variableHandles.create("system"),!1)]},this.sendResponse(e)}variablesRequest(e,t,n){return i(this,void 0,void 0,(function*(){const n=[];let i;const s=this._variableHandles.get(t.variablesReference);if("system"===s){let e=this._mconnect.getVariables("system");for(let t in e)n.push({name:t,type:"string",value:e[t],variablesReference:0})}else{const e=s.split("|"),t=parseInt(e.pop()),r=e.join("|");let o,a=this._mconnect.getVariables("local"),c=!0,u="";for(let e in a){let s=this.varAnalyze(e,a[e]);c?(o=s,c=!1):((i=this.checkVars(o,s,t,r,u))&&(0!==i.variablesReference&&(u=o.bases[t]),n.push(i)),o=s)}if(!c){const e={name:"",indexCount:0,bases:[],content:""};(i=this.checkVars(o,e,t,r,u))&&n.push(i)}}e.body={variables:n},this.sendResponse(e)}))}checkVars(e,t,n,i,s){let r=void 0,o=0;if(0===n||e.bases[n-1]===i&&e.indexCount>n)if(e.indexCount>n+1){if(s!==e.bases[n]){let t=e.bases[n];n>0&&(t+=")"),r={name:t,type:"string",value:"undefined",variablesReference:this._variableHandles.create(e.bases[n]+"|"+(n+1))}}}else e.bases[n]===t.bases[n]&&(o=this._variableHandles.create(e.bases[n]+"|"+(n+1))),r={name:e.name,type:"string",value:e.content,variablesReference:o};return r}continueRequest(e,t){this._mconnect.continue(),this.sendResponse(e)}nextRequest(e,t){this._mconnect.step("OVER"),this.sendResponse(e)}stepInRequest(e,t,n){this._mconnect.step("INTO"),this.sendResponse(e)}stepOutRequest(e,t,n){this._mconnect.step("OUTOF")}evaluateRequest(e,t){return i(this,void 0,void 0,(function*(){"hover"!==t.context&&"repl"!==t.context||this._mconnect.getSingleVar(t.expression).then(t=>{e.body={result:t.name+" := "+t.content,variablesReference:0},this.sendResponse(e)})}))}restartRequest(e){return i(this,void 0,void 0,(function*(){let e=u.readFileSync(this._program).toString().split("\n");this._mconnect.checkRoutine(e).then(e=>{e.length?c.window.showErrorMessage("File contains Problems - No Restart possible!"):this._mconnect.restart(this._program)})}))}disconnectRequest(e,t,n){this._mconnect.disconnect(),this.sendResponse(e)}createSource(e){return new s.Source(r.basename(e),this.convertDebuggerPathToClient(e),void 0,void 0,"mock-adapter-data")}varAnalyze(e,t){let n=1,i=[],s=e.length,r=e.indexOf("("),o=!0;if(r>0){i.push(e.substring(0,r)),n++;for(let t=r;t<s;t++)","===e.substring(t,t+1)&&o&&(i.push(e.substring(0,t)),n++),'"'===e.substring(t,t+1)&&(o=!o);i.push(e.substring(0,e.length-1))}else i.push(e);return{name:e,indexCount:n,bases:i,content:t}}refreshDiagnostics(e,t){let n=[];if(e){let i=[];for(let t=0;t<e.lineCount;t++){const n=e.lineAt(t);i.push(n.text)}this._mconnect.checkRoutine(i).then(i=>{for(let t=0;t<i.length;t++){let s=i[t].split(";"),r=parseInt(s[0])-1;isNaN(r)&&(r=0);let o=parseInt(s[1])-1;isNaN(o)&&(o=0);let a=e.lineAt(o).text.length;0===o&&0===r&&(a=0);let u=s[2],l=new c.Range(o,r,o,a),h=new c.Diagnostic(l,u,c.DiagnosticSeverity.Error);h.code=u,n.push(h)}t.clear(),t.set(e.uri,n)})}}}h.THREAD_ID=1,t.MumpsDebugSession=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(3);t.DebugSession=i.DebugSession,t.InitializedEvent=i.InitializedEvent,t.TerminatedEvent=i.TerminatedEvent,t.StoppedEvent=i.StoppedEvent,t.ContinuedEvent=i.ContinuedEvent,t.OutputEvent=i.OutputEvent,t.ThreadEvent=i.ThreadEvent,t.BreakpointEvent=i.BreakpointEvent,t.ModuleEvent=i.ModuleEvent,t.LoadedSourceEvent=i.LoadedSourceEvent,t.CapabilitiesEvent=i.CapabilitiesEvent,t.Thread=i.Thread,t.StackFrame=i.StackFrame,t.Scope=i.Scope,t.Variable=i.Variable,t.Breakpoint=i.Breakpoint,t.Source=i.Source,t.Module=i.Module,t.CompletionItem=i.CompletionItem,t.ErrorDestination=i.ErrorDestination;const s=n(15);t.LoggingDebugSession=s.LoggingDebugSession;const r=n(8);t.Logger=r;const o=n(4);t.Event=o.Event,t.Response=o.Response;const a=n(17);t.Handles=a.Handles;const c=r.logger;t.logger=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(6),s=n(4);class r{get event(){return this._event||(this._event=(e,t)=>{let n;return this._listener=e,this._this=t,n={dispose:()=>{this._listener=void 0,this._this=void 0}},n}),this._event}fire(e){if(this._listener)try{this._listener.call(this._this,e)}catch(e){}}hasListener(){return!!this._listener}dispose(){this._listener=void 0,this._this=void 0}}class o extends i.EventEmitter{constructor(){super(),this._sendMessage=new r,this._pendingRequests=new Map,this.onDidSendMessage=this._sendMessage.event}dispose(){}handleMessage(e){if("request"===e.type)this.dispatchRequest(e);else if("response"===e.type){const t=e,n=this._pendingRequests.get(t.request_seq);n&&(this._pendingRequests.delete(t.request_seq),n(t))}}_isRunningInline(){return this._sendMessage&&this._sendMessage.hasListener()}start(e,t){this._sequence=1,this._writableStream=t,this._rawData=new Buffer(0),e.on("data",e=>this._handleData(e)),e.on("close",()=>{this._emitEvent(new s.Event("close"))}),e.on("error",e=>{this._emitEvent(new s.Event("error","inStream error: "+(e&&e.message)))}),t.on("error",e=>{this._emitEvent(new s.Event("error","outStream error: "+(e&&e.message)))}),e.resume()}stop(){this._writableStream&&this._writableStream.end()}sendEvent(e){this._send("event",e)}sendResponse(e){e.seq>0?console.error(`attempt to send more than one response for command ${e.command}`):this._send("response",e)}sendRequest(e,t,n,i){const r={command:e};if(t&&Object.keys(t).length>0&&(r.arguments=t),this._writableStream){if(this._send("request",r),i){this._pendingRequests.set(r.seq,i);const e=setTimeout(()=>{clearTimeout(e);const t=this._pendingRequests.get(r.seq);t&&(this._pendingRequests.delete(r.seq),t(new s.Response(r,"timeout")))},n)}}else this._emitEvent(new s.Event("error","sendRequest: No writableStream"))}dispatchRequest(e){}_emitEvent(e){this.emit(e.event,e)}_send(e,t){if(t.type=e,t.seq=this._sequence++,this._writableStream){const e=JSON.stringify(t);this._writableStream.write(`Content-Length: ${Buffer.byteLength(e,"utf8")}\r\n\r\n${e}`,"utf8")}this._sendMessage.fire(t)}_handleData(e){for(this._rawData=Buffer.concat([this._rawData,e]);;){if(this._contentLength>=0){if(this._rawData.length>=this._contentLength){const e=this._rawData.toString("utf8",0,this._contentLength);if(this._rawData=this._rawData.slice(this._contentLength),this._contentLength=-1,e.length>0)try{let t=JSON.parse(e);this.handleMessage(t)}catch(e){this._emitEvent(new s.Event("error","Error handling data: "+(e&&e.message)))}continue}}else{const e=this._rawData.indexOf(o.TWO_CRLF);if(-1!==e){const t=this._rawData.toString("utf8",0,e).split("\r\n");for(let e=0;e<t.length;e++){const n=t[e].split(/: +/);"Content-Length"==n[0]&&(this._contentLength=+n[1])}this._rawData=this._rawData.slice(e+o.TWO_CRLF.length);continue}}break}}}o.TWO_CRLF="\r\n\r\n",t.ProtocolServer=o},function(e,t){e.exports=require("url")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(8),s=i.logger,r=n(3);class o extends r.DebugSession{constructor(e,t,n){super(t,n),this.obsolete_logFilePath=e,this.on("error",e=>{s.error(e.body)})}start(e,t){super.start(e,t),s.init(e=>this.sendEvent(e),this.obsolete_logFilePath,this._isServer)}sendEvent(e){if(!(e instanceof i.LogOutputEvent)){let t=e;e instanceof r.OutputEvent&&e.body&&e.body.data&&e.body.data.doNotLogOutput&&(delete e.body.data.doNotLogOutput,t=Object.assign({},e),t.body=Object.assign({},e.body,{output:"<output not logged>"})),s.verbose(`To client: ${JSON.stringify(t)}`)}super.sendEvent(e)}sendRequest(e,t,n,i){s.verbose(`To client: ${JSON.stringify(e)}(${JSON.stringify(t)}), timeout: ${n}`),super.sendRequest(e,t,n,i)}sendResponse(e){s.verbose(`To client: ${JSON.stringify(e)}`),super.sendResponse(e)}dispatchRequest(e){s.verbose(`From client: ${e.command}(${JSON.stringify(e.arguments)})`),super.dispatchRequest(e)}}t.LoggingDebugSession=o},function(e,t,n){var i=n(2),s=n(1),r=parseInt("0777",8);function o(e,t,n,a){"function"==typeof t?(n=t,t={}):t&&"object"==typeof t||(t={mode:t});var c=t.mode,u=t.fs||s;void 0===c&&(c=r&~process.umask()),a||(a=null);var l=n||function(){};e=i.resolve(e),u.mkdir(e,c,(function(n){if(!n)return l(null,a=a||e);switch(n.code){case"ENOENT":o(i.dirname(e),t,(function(n,i){n?l(n,i):o(e,t,l,i)}));break;default:u.stat(e,(function(e,t){e||!t.isDirectory()?l(n,a):l(null,a)}))}}))}e.exports=o.mkdirp=o.mkdirP=o,o.sync=function e(t,n,o){n&&"object"==typeof n||(n={mode:n});var a=n.mode,c=n.fs||s;void 0===a&&(a=r&~process.umask()),o||(o=null),t=i.resolve(t);try{c.mkdirSync(t,a),o=o||t}catch(s){switch(s.code){case"ENOENT":o=e(i.dirname(t),n,o),e(t,n,o);break;default:var u;try{u=c.statSync(t)}catch(e){throw s}if(!u.isDirectory())throw s}}return o}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Handles=class{constructor(e){this.START_HANDLE=1e3,this._handleMap=new Map,this._nextHandle="number"==typeof e?e:this.START_HANDLE}reset(){this._nextHandle=this.START_HANDLE,this._handleMap=new Map}create(e){var t=this._nextHandle++;return this._handleMap.set(t,e),t}get(e,t){return this._handleMap.get(e)||t}}},function(e,t){function n(){this.waiters=[]}n.prototype.wait=function(e){var t=this,n={};this.waiters.push(n);var i=new Promise((function(e){var i=!1;n.resolve=function(s){if(!i){if(i=!0,n.timeout&&(clearTimeout(n.timeout),n.timeout=null),!s){var r=t.waiters.indexOf(n);r>-1&&t.waiters.splice(r,1)}e()}}}));return e>0&&isFinite(e)&&(n.timeout=setTimeout((function(){n.timeout=null,n.resolve()}),e)),i},n.prototype.notify=function(){this.waiters.length>0&&this.waiters.pop().resolve(!0)},n.prototype.notifyAll=function(){for(var e=this.waiters.length-1;e>=0;e--)this.waiters[e].resolve(!0);this.waiters=[]},t.Subject=n},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){e.done?s(e.value):new n((function(t){t(e.value)})).then(o,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=n(7),r=n(6),o=n(1);class a extends r.EventEmitter{constructor(){super(),this._event=new r.EventEmitter,this._currentLine=0,this._breakpointId=1,this._logging=!1,this._singleVar="",this._singleVarContent="",this._commandQueue=[],this._socket=new s.Socket,this._connectState="waitingforStart",this._readedData="",this._mVars={},this._mStack=[],this._activeBreakpoints=[],this._breakPoints=[],this._errorLines=[],this._singleVar="",this._singleVarContent="",this._hints=[],this._event.on("varsComplete",()=>{if(void 0!==this._mVars.I){let e=this._mVars.I;this.checkEvents(e.$ZPOSITION,e.$ZSTATUS)}})}init(e,t,n){return i(this,void 0,void 0,(function*(){return this._localRoutinesPath=n,this._hostname=e,this._port=t,new Promise((e,t)=>{this._socket.connect(this._port,this._hostname,()=>{this._log("Debug-Server connected\n"),this._socket.on("data",e=>{this._readedData+=e.toString();let t=this._readedData.indexOf("\n");for(;-1!==t;)this.processLine(this._readedData.substring(0,t)),this._readedData=this._readedData.substring(t+1),t=this._readedData.indexOf("\n")}),e(this._socket)}),this._socket.on("error",e=>{t(e)})})}))}_log(e){this._logging&&console.log(e)}processLine(e){let t,n,i;switch(this._connectState){case"waitingforStart":if("***STARTVAR"===e){this._connectState="waitingforVars",this._mStack=[],this._mVars={};break}if("***STARTBP"===e){this._connectState="waitingforBreakpoints",this._activeBreakpoints=[],this._log(e);break}if("***SINGLEVAR"===e){this._connectState="waitingForSingleVar",this._singleVar="",this._singleVarContent="";break}if("***ENDPROGRAM"===e){this.sendEvent("end"),this._socket.end();break}if("***BEGINERRCHK"===e){this._connectState="waitingForErrorreport",this._errorLines=[];break}if("***STARTHINTS"===e){this._connectState="waitingForHints",this._hints=[];break}break;case"waitingforVars":if("***ENDVAR"===e)this._connectState="waitingforStart",this._event.emit("varsComplete");else{for(i=e.substring(0,1),"S"===i&&this._mStack.push(e.substring(2)),t=e.substring(2,e.indexOf("="));(t.split('"').length-1)%2!=0;)t=e.substring(0,e.indexOf("=",t.length+1));n=e.substring(t.length+3).replace(/^"/,"").replace(/"$/,""),void 0===this._mVars[i]&&(this._mVars[i]={}),this._mVars[i][t]=n}break;case"waitingforBreakpoints":"***ENDBP"===e?(this._log(e),this._connectState="waitingforStart",this.verifyBreakpoints()):(this._log(e),this._activeBreakpoints.push(e));break;case"waitingForSingleVar":"***SINGLEEND"===e?(this._connectState="waitingforStart",this._event.emit("SingleVarReceived",this._event,this._singleVar,this._singleVarContent)):"***SINGLEVARCONTENT"===e?this._connectState="waitingForSingleVarContent":this._singleVar+=e;break;case"waitingForSingleVarContent":"***SINGLEEND"===e?(this._connectState="waitingforStart",this._event.emit("SingleVarReceived",this._event,this._singleVar,this._singleVarContent)):this._singleVarContent+=e;break;case"waitingForErrorreport":"***ENDERRCHK"===e?(this._connectState="waitingforStart",this._event.emit("ErrorreportReceived",this._event,this._errorLines)):this._errorLines.push(e);break;case"waitingForHints":"***ENDHINTS"===e?(this._connectState="waitingforStart",this._event.emit("HintsReceived",this._event,this._hints)):this._hints.push(e);default:console.error("Unexpected Message: "+e)}}writeln(e){if(this._commandQueue.push(e),this._commandQueue.length>1e3)throw console.error("Too many Commands in Queue Check Debugger Connection"),new Error;if(this._socket&&this._socket.writable)for(;this._commandQueue.length;)e=this._commandQueue.shift(),this._log(e),this._socket.write(e+"\n")}sendBreakpoint(e,t,n){n?this.writeln("SETBP;"+e+";"+t):this.writeln("CLEARBP;"+e+";"+t)}start(e,t){t&&(e.indexOf("^")?this.sendBreakpoint(e,0,!0):this.sendBreakpoint(e,1,!0)),this.requestBreakpoints(),this.writeln("START;"+e)}step(e){this.writeln(e)}continue(){this.writeln("CONTINUE")}disconnect(){this.writeln("RESET"),this._socket.end()}requestBreakpoints(){this.writeln("REQUESTBP")}restart(e){this.writeln("RESTART;"+e)}checkEvents(e,t){const n=e.split("^"),i=n[0],s=n[1],r=this._localRoutinesPath+s+".m";this.loadSource(r);const o=i.split("+")[0];let a=0;"undefined"!==i.split("+")[1]&&(a=parseInt(i.split("+")[1]));let c=0;if(""!==o)for(let e=0;e<this._sourceLines.length;e++)if(this._sourceLines[e].substring(0,o.length)===o){c=e;break}if(this._currentLine=c+a,""!==t)this.sendEvent("stopOnException",t);else{this._breakPoints.filter(e=>e.file===this._sourceFile&&e.line===this._currentLine).length>0?this.sendEvent("stopOnBreakpoint"):this.sendEvent("stopOnStep")}}stack(e,t){const n=new Array;for(let t=e;t<this._mStack.length;t++){const e=this._mStack[t],i=this.convertMumpsPosition(e);i.line++,n.push({index:t,name:`${e}(${t})`,file:i.file,line:i.line})}return{frames:n,count:Math.min(this._mStack.length,t)}}setBreakPoint(e,t){const n={verified:!1,file:e,line:t,id:this._breakpointId++};return this._breakPoints.push(n),this.sendBreakpoint(e,n.line+1,!0),n}clearBreakPoint(e,t){let n=this._breakPoints;if(n){const i=n.findIndex(n=>n.file===e&&n.line===t);if(i>=0){const t=n[i];return this.sendBreakpoint(e,t.line,!1),n.splice(i,1),t}}}clearBreakpoints(e){this.writeln("CLEARBP;"+e)}verifyBreakpoints(){let e=[];this._breakPoints.forEach(t=>{t.verified=!1;for(let n=0;n<this._activeBreakpoints.length;n++){let i=this.convertMumpsPosition(this._activeBreakpoints[n]);if(i.file===t.file&&t.line===i.line){t.verified=!0,this.sendEvent("breakpointValidated",t),e[n]=!0;break}}t.verified||this.sendEvent("breakpointValidated",t)});for(let t=0;t<this._activeBreakpoints.length;t++)if(!e[t]){let e=this.convertMumpsPosition(this._activeBreakpoints[t]),n={verified:!0,file:e.file,line:e.line,id:this._breakpointId++};this.sendEvent("breakpointValidated",n)}}getVariables(e){return"system"===e?this._mVars.I:"local"===e?this._mVars.V:void 0}requestHints(e){return i(this,void 0,void 0,(function*(){return new Promise((t,n)=>{this._event.on("HintsReceived",(function e(n,i){n.removeListener("HintsReceived",e),t(i)})),this.writeln("GETHINTS;"+e)})}))}checkRoutine(e){return i(this,void 0,void 0,(function*(){return new Promise((t,n)=>{this._event.on("ErrorreportReceived",(function e(n,i){n.removeListener("ErrorreportReceived",e),t(i)})),this.writeln("ERRCHK");for(let t=0;t<e.length;t++)this.writeln(e[t]);this.writeln("***ENDPROGRAM")})}))}getSingleVar(e){return i(this,void 0,void 0,(function*(){return new Promise((t,n)=>{let i={name:e,indexCount:0,content:"undefined",bases:[]};"$"===e.substring(0,1)?(i.content=void 0!==this._mVars.I?this._mVars.I[e]:"undefined",t(i)):void 0!==this._mVars.V?void 0!==this._mVars.V[e]?(i.content=this._mVars.V[e],t(i)):(this._event.on("SingleVarReceived",(function e(n,s,r){n.removeListener("SingleVarReceived",e),i.name=s,i.content=r,t(i)})),this.writeln("GETVAR;"+e)):t(i)})}))}loadSource(e){this._sourceFile!==e&&(this._sourceFile=e,this._sourceLines=o.readFileSync(this._sourceFile).toString().split("\n"))}convertMumpsPosition(e){let t=e.split("^"),n=t[0],i=t[1].split(" ",1)[0],s=this._localRoutinesPath+i+".m",r=o.readFileSync(s).toString().split("\n"),a=n.split("+")[0],c=0;void 0!==n.split("+")[1]&&(c=parseInt(n.split("+")[1]));let u=0;if(""!==a)for(let e=0;e<r.length;e++)if(r[e].substring(0,a.length)===a){u=e;break}return{file:s,line:u+c-1}}sendEvent(e,...t){setImmediate(n=>{this.emit(e,...t)})}}t.MConnect=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let i=n(0).Hover,s=n(5).MumpsToken;t.MumpsHoverProvider=class{provideHover(e,t){let n=new s(e,t);if((n.mayBeCommand||n.isIntrinsic||n.isLabelReference)&&n.definition){let e=n.definition,t={language:"typescript",value:e.functionSignature||e.name};return new i([t,e.description])}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let i=n(1),s=n(2);const r=n(0),o=n(9);let a=r.Position,c=r.Uri;const u=[".M",".INT",".ZWR",".m",".int",".zwr"];let l={};t.lookupLabelReference=function(e){let t=e.labelProgram?function e(t,n){let r=s.resolve(t.uri.fsPath,"../"+n);if(!i.existsSync(r)){if("%"===n.charAt(0))return e(t,"_"+n.substring(1));for(let e of u){let t=r+e;if(i.existsSync(t)){r=t;break}}}return c.file(r)}(e.document,e.labelProgram):e.document.uri,n=function(e,t){let n=e.split("\n"),i="",s=0;for(s=0;s<n.length;s++)if(null!==n[s].match("^"+t)){i+=n[s]+"\n";for(let e=s-1;e>0&&(0===n[e].length||";"===n[e].charAt(1));e--)i+=n[e]+"\n";break}if(i.length>0)return{text:i,line:s}}(function(e,t){if(e===t.uri)return t.getText();if(e.fsPath===l.fsPath)return l.text;try{return l.text=i.readFileSync(e.fsPath,"utf8"),l.fsPath=e.fsPath,l.text}catch(e){return""}}(t,e.document),e.label);return n?n.position=new a(n.line+(e.labelOffset||0),0):n={text:"",position:new a(0,0)},n.uri=t,n},t.createDefinitionForLabelReference=function(e){if(!e.text)return;let t=/^([%A-Z][A-Z0-9]*)(\((,?[%A-Z][A-Z0-9]*)+\))?/i.exec(e.text);if(!t)return;let n=t[2].substring(1,t[2].length-1).split(","),i={};for(let e=0;e<n.length;e++)n[e]={name:n[e],type:"any"},i[n[e].name]=n[e];let s={name:t[1],type:"function",parameters:n};return o.getSigInfo(e,s,i),s}},function(e){e.exports=JSON.parse('[{"name":"BREAK","type":"command","abbreviation":"B","description":"Suspend execution or exit a block"},{"name":"CLOSE","type":"command","abbreviation":"C","description":"Release an I/O device"},{"name":"DO","type":"command","abbreviation":"D","description":"Execute a program, section of code or block"},{"name":"ELSE","type":"command","abbreviation":"E","description":"Conditional execution based on $test"},{"name":"FOR","type":"command","abbreviation":"F","description":"Iterative execution of a line or block"},{"name":"GOTO","type":"command","abbreviation":"G","description":"Transfer of control to a label or program"},{"name":"HALT","type":"command","abbreviation":"H","description":"Terminate execution"},{"name":"HANG","type":"command","abbreviation":"H","description":"Delay execution for a specified period of time"},{"name":"IF","type":"command","abbreviation":"I","description":"Conditional execution of remainder of line"},{"name":"JOB","type":"command","abbreviation":"J","description":"Start an independent process"},{"name":"LOCK","type":"command","abbreviation":"L","description":"Exclusive access/release named resource"},{"name":"KILL","type":"command","abbreviation":"K","description":"Delete a local or global variable"},{"name":"MERGE","type":"command","abbreviation":"M","description":"Copy arrays"},{"name":"NEW","type":"command","abbreviation":"N","description":"Create new copies of local variables"},{"name":"OPEN","type":"command","abbreviation":"O","description":"Obtain ownership of a device"},{"name":"QUIT","type":"command","abbreviation":"Q","description":"End a for loop or exit a block"},{"name":"READ","type":"command","abbreviation":"R","description":"Read from a device"},{"name":"SET","type":"command","abbreviation":"S","description":"Assign a value to a global or local variable"},{"name":"TCOMMIT","type":"command","abbreviation":"TC","description":"Commit a transaction"},{"name":"TRESTART","type":"command","abbreviation":"TRE","description":"Roll back / restart a transaction"},{"name":"TROLLBACK","type":"command","abbreviation":"TRO","description":"Roll back a transaction"},{"name":"TSTART","type":"command","abbreviation":"TS","description":"Begin a transaction"},{"name":"USE","type":"command","abbreviation":"U","description":"Select which device to read/write"},{"name":"VIEW","type":"command","abbreviation":"V","description":"Implementation defined"},{"name":"WRITE","type":"command","abbreviation":"W","description":"Write to device"},{"name":"XECUTE","type":"command","abbreviation":"X","description":"Dynamically execute strings"},{"name":"ZALLOCATE","type":"command","abbreviation":"ZA","description":"Reserves the specified name"},{"name":"ZBREAK","type":"command","abbreviation":"ZB","description":"Sets or clears a routine breakpoint"},{"name":"ZCOMPILE","type":"command","abbreviation":"ZCOM","description":"Compiles a routine"},{"name":"ZCONTINUE","type":"command","abbreviation":"ZC","description":"Continues excutioen after a break"},{"name":"ZDEALLOCATE","type":"command","abbreviation":"ZD","description":"Release the specified name"},{"name":"ZEDIT","type":"command","abbreviation":"ZE","description":"Invokes editor for routine editing"},{"name":"ZGOTO","type":"command","abbreviation":"ZG","description":"Moves to EntryRef on a given stacklevel"},{"name":"ZHALT","type":"command","abbreviation":"ZHALT","description":"Stops program execution with a return code"},{"name":"ZHELP","type":"command","abbreviation":"ZH","description":"Accessses M help library"},{"name":"ZKILL","type":"command","abbreviation":"ZK","description":"Kills a data value but not the descendants"},{"name":"ZLINK","type":"command","abbreviation":"ZL","description":"Compiles an links a routine to the current process"},{"name":"ZMESSAGE","type":"command","abbreviation":"ZM","description":"Raises an exception specified by given code"},{"name":"ZPRINT","type":"command","abbreviation":"ZP","description":"Displays source code lines"},{"name":"ZRUPDATE","type":"command","abbreviation":"ZRUPDATE","description":"Publishes the new versions of routines to subscribers"},{"name":"ZSHOW","type":"command","abbreviation":"ZSH","description":"Displays information about the current environment"},{"name":"ZSTEP","type":"command","abbreviation":"ZST","description":"Controls routine execution"},{"name":"ZSYSTEM","type":"command","abbreviation":"ZSY","description":"Creates a child of the current process"},{"name":"ZTCOMMIT","type":"command","abbreviation":"ZTC","description":"Marks the end of a logical transaction"},{"name":"ZTRIGGER","type":"command","abbreviation":"ZTR","description":"Invokes specified Global Triggers"},{"name":"ZTSTART","type":"command","abbreviation":"ZTS","description":"Marks the beginning of a logical transaction"},{"name":"ZWITHDRAW","type":"command","abbreviation":"ZWI","description":"Kills a data value but not the descendants"},{"name":"ZWRITE","type":"command","abbreviation":"ZWR","description":"Displays a complete global or local variable"},{"name":"$DEVICE","type":"variable","abbreviation":"$D","description":"Status of the current device"},{"name":"$ECODE","type":"variable","abbreviation":"$EC","description":"List of unresolved error codes"},{"name":"$ESTACK","type":"variable","abbreviation":"$ES","description":"Number of stack levels; NEWing $ESTACK resets it to 0"},{"name":"$ETRAP","type":"variable","abbreviation":"$ET","description":"Code to execute on error"},{"name":"$HOROLOG","type":"variable","abbreviation":"$H","description":"Days,seconds time stamp"},{"name":"$IO","type":"variable","abbreviation":"$I","description":"Current IO unit"},{"name":"$JOB","type":"variable","abbreviation":"$J","description":"Current process ID"},{"name":"$KEY","type":"variable","abbreviation":"$K","description":"String that terminated the most recent READ command"},{"name":"$PRINCIPAL","type":"variable","abbreviation":"$P","description":"Principal I/O device"},{"name":"$QUIT","type":"variable","abbreviation":"$Q","description":"Whether the current block of code was called as an extrinsic function (e.g. via $$)"},{"name":"$STACK","type":"variable","abbreviation":"$ST","description":"Current process stack level"},{"name":"$STORAGE","type":"variable","abbreviation":"$S","description":"Amount of memory available, in bytes"},{"name":"$SYSTEM","type":"variable","abbreviation":"$SY","description":"System ID"},{"name":"$TEST","type":"variable","abbreviation":"$T","description":"Result of prior IF command or READ/OPEN/LOCK command if invoked with a timeout"},{"name":"$TLEVEL","type":"variable","abbreviation":"$TL","description":"Number transactions in process"},{"name":"$TRESTART","type":"variable","abbreviation":"$TR","description":"Number of restarts on current transaction"},{"name":"$X","type":"variable","abbreviation":"$X","description":"Position of horizontal cursor in current I/O device"},{"name":"$Y","type":"variable","abbreviation":"$Y","description":"Position of vertical cursor in current I/O device"},{"name":"$ASCII","type":"function","abbreviation":"$A","description":"ASCII numeric code of a character","parameters":[{"name":"VALUE","type":"string","description":"A string to get a code from"},{"name":"POS","type":"number","optional":true,"description":"The 1-based position of the character in VALUE; defaults to 1"}],"returns":{"type":"number"}},{"name":"$CHAR","type":"function","abbreviation":"$C","description":"ASCII character from numeric code","parameters":[{"name":"CODE","type":"number","description":"Numeric code to convert to a character"},{"name":"...","type":"number","optional":true,"description":"Additional codes to convert to characters"}],"returns":{"type":"string"}},{"name":"$DATA","type":"function","abbreviation":"$D","description":"Returns data about a variable: 0: if undefined, 1: if valued but has no descendants, 10: if has descendants but no value; 11: if has both a value and descendants","parameters":[{"name":"VAR","type":"reference","description":"The variable to get data about, e.g. ^X"}],"returns":{"type":"number"}},{"name":"$EXTRACT","type":"function","abbreviation":"$E","description":"Extract a substring","parameters":[{"name":"VALUE","type":"string","description":"The string to get a substring from"},{"name":"START","type":"number","optional":true,"description":"The 1-based start index; defaults to 1"},{"name":"END","type":"number","optional":true,"description":"The 1-based end index; defaults to 2"}],"returns":{"type":"string"}},{"name":"$FIND","type":"function","abbreviation":"$F","description":"Find the 1-based index after the end of a substring or 0 if not found","parameters":[{"name":"WITHIN","type":"string","description":"The string to search in"},{"name":"SUBSTRING","type":"string","description":"The substring to search for"},{"name":"START","type":"number","optional":true,"description":"The 1-based index to start searching from; defaults to 1"}],"returns":{"type":"number"}},{"name":"$FNUMBER","type":"function","abbreviation":"$FN","description":"Format a number","parameters":[{"name":"NUMBER","type":"number","description":"The number to format"},{"name":"FORMAT","type":"string","description":"One or more of the following: +: forces \\"+\\" on positive numbers; -: omits the \\"-\\" on negative numbers; ,: comma-separates the number by thousands; T: puts the sign in the trailing position; P: wraps negative numbers in parentheses and wraps positive numbers in spaces and may only be combined with comma (,)"},{"name":"DIGITS","type":"number","optional":true,"description":"The numer of digits after the decimal point"}],"returns":{"type":"any"}},{"name":"$GET","type":"function","abbreviation":"$G","description":"Get default or actual value","parameters":[{"name":"VAR","type":"reference","description":"The variable to query, e.g. ^X(THIS,THAT)"},{"name":"DEFAULT","type":"any","optional":true,"description":"A value to use if VAR has no value; defaults to \\"\\""}],"returns":{"type":"any"}},{"name":"$JUSTIFY","type":"function","abbreviation":"$J","description":"Right-justify a number or string by prefixing with spaces","parameters":[{"name":"VALUE","type":"string","description":"The string to justify"},{"name":"MINLENGTH","type":"number","description":"The minimum length of the result"},{"name":"DIGITS","type":"number","description":"The number of digits after the decimal point; providing this argument makes $JUSTIFY treat VALUE as a number"}],"returns":{"type":"string"}},{"name":"$LENGTH","type":"function","abbreviation":"$L","description":"Determine string length","parameters":[{"name":"VALUE","type":"string","description":"The string"},{"name":"SUBSTRING","type":"string","optional":true,"description":"If present, $LENGTH returns one more than the number of occurences of SUBSTRING in VALUE"}],"returns":{"type":"number"}},{"name":"$NAME","type":"function","abbreviation":"$NA","description":"Evaluate and describe a variable","parameters":[{"name":"VAR","type":"reference","description":"The variable to evaluate, including naked references"},{"name":"MAXSUBSCRIPT","type":"number","optional":true,"description":"The maximum number of subscripts to evaluate if VAR is an array"}],"returns":{"type":"string"}},{"name":"$ORDER","type":"function","abbreviation":"$O","description":"Find the subscript of the next or previous node","parameters":[{"name":"VAR","type":"reference","description":"The array to query, e.g. ^AR"},{"name":"DIRECTION","type":"number","optional":true,"description":"1: forward, -1: reverse; defaults to 1"}],"returns":{"type":"string|number"}},{"name":"$PIECE","type":"function","abbreviation":"$P","description":"Extract substring based on pattern","parameters":[{"name":"VALUE","type":"string","description":"The string"},{"name":"SUBSTRING","type":"string","description":"A delimiting string within VALUE"},{"name":"PIECE","type":"number","optional":true,"description":"Which 1-based piece of the split string to return; defaults to 1"},{"name":"LASTPIECE","type":"number","optional":true,"description":"The 1-based index of the last piece of the split string to return; defaults to PIECE"}],"returns":{"type":"any"}},{"name":"$QLENGTH","type":"function","abbreviation":"$QL","description":"Number of subscripts in an array reference","parameters":[{"name":"VAR","type":"reference","description":"The array to query, e.g. ^AR"}],"returns":{"type":"any"}},{"name":"$QSUBSCRIPT","type":"function","abbreviation":"$QS","description":"Value of specified subscript","parameters":[{"name":"VAR","type":"reference","description":"The array to query, e.g. ^AR"},{"name":"SUBSCRIPT","type":"number","description":"The 1-based index of the subscript to find; special values include -1: environment and 0: unsubscripted name"}],"returns":{"type":"string|number"}},{"name":"$QUERY","type":"function","abbreviation":"$Q","description":"Next item in an array; invoke multiple times to iterate the entire array","parameters":[{"name":"VAR","type":"reference","description":"The array to query, e.g. ^AR"}],"returns":{"type":"any"}},{"name":"$RANDOM","type":"function","abbreviation":"$R","description":"Random number","parameters":[{"name":"LIMIT","type":"number","description":"The generated random number will be between 0 (inclusive) and this LIMIT (exclusive)"}],"returns":{"type":"number"}},{"name":"$REVERSE","type":"function","abbreviation":"$RE","description":"String in reverse order","parameters":[{"name":"VALUE","type":"string","description":"A string to reverse"}],"returns":{"type":"string"}},{"name":"$SELECT","type":"function","abbreviation":"$S","description":"Value of first true argument","parameters":[{"name":"TVEXPR","type":"expression","description":"An expression to test for truth, followed by a colon and a value, e.g. i=42:\\"Answered!\\""},{"name":"...","type":"expression","optional":true,"description":"Additional truth value expressions to test; the last expression often starts with 1: to avoid errors"}],"returns":{"type":"any"}},{"name":"$STACK","type":"function","abbreviation":"$ST","description":"Returns information about the process stack","parameters":[{"name":"LEVEL","type":"number","description":"-1: returns the highest stack level; 0: returns information about how the program was started; 1 to $STACK(-1): returns information about how the stack level was created"},{"name":"FIELD","type":"string","optional":true,"description":"\\"MCODE\\": the line of code that was executed; \\"PLACE\\": location of the executed code; \\"ECODE\\": the error code(s) added at the stack level, if any"}],"returns":{"type":"string|number"}},{"name":"$TEXT","type":"function","abbreviation":"$T","description":"Returns the text of a line of M[UMPS] code","parameters":[{"name":"REFERENCE","type":"string","description":"A reference to a code location, e.g. \'LABEL\' or \'+4^PROGRAM\' or \'LABEL^PROGRAM\', etc."}],"returns":{"type":"string"}},{"name":"$TRANSLATE","type":"function","abbreviation":"$TR","description":"Translate characters in a string","parameters":[{"name":"VALUE","type":"string","description":"The value to translate"},{"name":"OLD","type":"string","description":"Characters in VALUE to replace"},{"name":"NEW","type":"string","optional":true,"description":"Characters to replace OLD characters with; if not provided then OLD characters will be removed"}],"returns":{"type":"string"}},{"name":"$VIEW","type":"function","abbreviation":"$V","description":"Implementation defined"}]')},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let i=n(0).Location,s=n(5).MumpsToken;t.MumpsDefinitionProvider=class{provideDefinition(e,t){let n=new s(e,t);if(n.isLabelReference&&n.referredToLabel){let e=n.referredToLabel.position;return new i(n.referredToLabel.uri,e)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);let s=i.ParameterInformation,r=i.Position,o=i.SignatureHelp,a=i.SignatureInformation,c=n(5).MumpsToken;t.MumpsSignatureHelpProvider=class{provideSignatureHelp(e,t){let n=e.lineAt(t);if(!n)return;let i=function(e,t,n){let i,s=1;for(i=n.character-1;i>0&&s>0;i--){let e=t.text.charAt(i);")"===e?s++:"("===e&&s--}if(s>0||i<=0)return;return new c(e,new r(n.line,i))}(e,n,t);if(!i||!i.definition)return;let u=function(e){let t=new a(e.functionSignature,e.description);if(e.parameters){t.parameters=[];for(let n of e.parameters){let e=n.optional?"(optional) ":"";e+=n.description||n.name,t.parameters.push(new s(n.name,e))}}return t}(i.definition),l=new o;return l.signatures=[u],l.activeSignature=0,l.activeParameter=function(e,t,n){let i=0,s=0;for(let r=t+1;r<n;r++){let t=e.charAt(r);"("===t?s++:")"===t?s--:","===t&&0===s&&i++}return i}(n.text,i.position.character+1,t.character),l}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),s=n(26);t.MumpsDocumentSymbolProvider=class{provideDocumentSymbols(e){return new Promise(t=>{let n=s.parseText(e.getText()),r=[];n.methods.forEach(t=>{let n=i.SymbolKind.Function,s=new i.Position(t.id.position.line,0),o=-1===t.endLine?e.lineCount-1:t.endLine,a=new i.Position(o,0),c=new i.Location(e.uri,new i.Range(s,a));r.push(new i.SymbolInformation(t.id.value,n,"",c))}),t(r)})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(27);var s;!function(e){e[e.method=1]="method",e[e.parameter=2]="parameter",e[e.declaration=4]="declaration",e[e.column=5]="column",e[e.table=6]="table",e[e.proc=7]="proc"}(s=t.MemberClass||(t.MemberClass={}));class r{constructor(){this.parameters=[],this.line=-1,this.declarations=[],this.endLine=-1,this.memberClass=s.method,this.documentation=""}}class o{constructor(){}}t.parseText=function(e){return(new a).parseDocument(e)};class a{constructor(e){this.methods=[],this.declarations=[],this.tokens=[],e&&(this.tokenizer=e)}next(){return this.activeToken=this.tokenizer.next().value,this.activeToken&&this.tokens.push(this.activeToken),void 0!==this.activeToken}parseDocument(e){for(this.tokenizer=i.getTokens(e);this.next();)if(this.activeToken.isAlphanumeric()){let e=this.parseMethod();if(!e)continue;this.methods.push(e),this.activeMethod=e}else if(this.activeToken.isTab()||this.activeToken.isSpace()){let e=this.activeToken.position.line,t=this.loadTokenBuffer();if(this.activeMethod&&this.activeMethod.nextLine===e){let e=this.checkForDocumentation(t);e&&(this.activeMethod.documentation=e)}}else{if(this.activeToken.isNewLine())continue;this.throwAwayTokensTil(13)}return{declarations:this.declarations,methods:this.methods,tokens:this.tokens}}checkForDocumentation(e){let t=0;for(;t<e.length;){let n=e[t];if(!n.isSpace()&&!n.isTab())return n.isLineCommentInit()&&e[t+1]&&e[t+1].isLineComment()?e[t+1].value:"";t++}return""}loadTokenBuffer(){let e=[];for(;this.next()&&13!==this.activeToken.type;)e.push(this.activeToken);return e}parseMethod(){let e=new r;do{if(this.activeToken&&!this.activeToken.isTab()&&!this.activeToken.isSpace()){if(this.activeToken.isNewLine())break;if(this.activeToken.isOpenParen()){let t=this.processParameters(e);if(!t)return;e.parameters=t;break}if(this.activeToken.isAlphanumeric())-1===e.line&&(e.line=this.activeToken.position.line,e.prevLine=this.activeToken.position.line-1,e.nextLine=this.activeToken.position.line+1,e.id=this.activeToken);else{if(this.activeToken.isLineCommentInit()||this.activeToken.isLineComment())continue;if("\r"===this.activeToken.value)continue;if(!this.activeToken.isCloseParen()){if(this.throwAwayTokensTil(13),e.id)break;return}e.closeParen||(e.closeParen=this.activeToken,e.nextLine=this.activeToken.position.line+1)}}}while(this.next());return this.activeMethod&&(this.activeMethod.endLine=e.id.position.line-1),this.activeMethod=e,e}processParameters(e){let t,n=[],i=!1;for(;this.next();)if(!(this.activeToken.isTab()||this.activeToken.isSpace()||this.activeToken.isNewLine()))if(this.activeToken.isOpenParen()){if(i=!0,!t)return}else{if(this.activeToken.isCloseParen()){if(i=!1,e.closeParen=this.activeToken,e.nextLine=this.activeToken.position.line+1,!t)break;n.push(t);break}if(this.activeToken.isAlphanumeric())t||(t=new o),t.id=this.activeToken;else if(this.activeToken.isLineComment())t?t.comment=this.activeToken:n.length>=1&&(n[n.length-1].comment=this.activeToken);else if(this.activeToken.isComma()){if(!t)return;n.push(t),t=void 0}}if(!i)return n}throwAwayTokensTil(e){do{}while(this.next()&&this.activeToken.type!==e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);t.getTokens=function*(e){let t=new r;for(let n of e){for(t.charType=o(n),0===t.tokenType&&(t.tokenType=t.charType);!t.parsed;)t.parseCharacter(n)&&(yield t.finalizedToken);t.parsed=!1}0!==t.tokenType&&(t.finalizeToken(0),yield t.finalizedToken)};class s{constructor(e,t,n){this.type=e,this.value=t,this.position=n}getRange(){let e=this.position,t=new i.Position(this.position.line,this.position.character+this.value.length);return new i.Range(e,t)}isAlphanumeric(){return 1===this.type}isCloseParen(){return 41===this.type}isComma(){return 44===this.type}isLineComment(){return 3===this.type}isLineCommentInit(){return 6===this.type}isNewLine(){return 13===this.type}isNumeric(){return 2===this.type}isOpenParen(){return 40===this.type}isSpace(){return 32===this.type}isTab(){return 11===this.type}isWhiteSpace(){return 32===this.type||11===this.type||13===this.type||-1===this.type}}t.Token=s;class r{constructor(){this.documentLine=0,this.documentColumn=0,this.charType=0,this.tokenType=0,this.tokenValue="",this.tokenPosition=new i.Position(this.documentLine,this.documentColumn),this.parsed=!1,this.stringOpen=!1,this.firstSlash=!1,this.asterisk=!1}parseCharacter(e){return 1===this.tokenType?1===this.charType||2===this.charType?(this.updateTokenAndAdvanceCursor(e),!1):(this.finalizeToken(this.charType),!0):2===this.tokenType?2===this.charType?(this.updateTokenAndAdvanceCursor(e),!1):(this.finalizeToken(this.charType),!0):3===this.tokenType?13!==this.charType?(this.updateTokenAndAdvanceCursor(e),!1):(this.finalizeToken(13),!0):5===this.tokenType?9!==this.charType?(this.updateTokenAndAdvanceCursor(e),!1):(this.finalizeToken(9),!0):6===this.tokenType?(this.updateTokenAndAdvanceCursor(e),this.finalizeToken(3),!0):59===this.tokenType?(this.tokenType=6,!0):9===this.tokenType?(this.updateTokenAndAdvanceCursor(e),this.stringOpen?(this.stringOpen=!1,this.finalizeToken(0)):(this.stringOpen=!0,this.finalizeToken(5)),!0):13===this.tokenType?(this.tokenValue=this.tokenValue+e,this.parsed=!0,this.documentLine++,this.documentColumn=0,this.finalizeToken(0),!0):(this.tokenType>10||-1===this.tokenType)&&(this.updateTokenAndAdvanceCursor(e),this.finalizeToken(0),!0)}updateTokenAndAdvanceCursor(e){this.tokenValue=this.tokenValue+e,this.parsed=!0,this.documentColumn++}finalizeToken(e){this.finalizedToken=new s(this.tokenType,this.tokenValue,this.tokenPosition),this.tokenType=e,this.tokenValue="",this.tokenPosition=new i.Position(this.documentLine,this.documentColumn)}}function o(e){let t=e.charCodeAt(0);return t>=65&&t<=90||t>=97&&t<=122||37===t?1:t>=48&&t<=57?2:34===t?9:9===t?11:10===t?13:32===t?32:33===t?33:35===t?35:36===t?36:38===t?38:39===t?39:40===t?40:41===t?41:42===t?42:43===t?43:44===t?44:45===t?45:46===t?46:58===t?58:59===t?59:60===t?60:61===t?61:62===t?62:63===t?63:64===t?64:91===t?91:92===t?92:93===t?93:94===t?94:95===t?95:96===t?96:123===t?123:124===t?124:125===t?125:126===t?126:-1}!function(e){e[e.Alphanumeric=1]="Alphanumeric",e[e.Numeric=2]="Numeric",e[e.LineComment=3]="LineComment",e[e.BlockComment=4]="BlockComment",e[e.String=5]="String",e[e.LineCommentInit=6]="LineCommentInit",e[e.DoubleQuotes=9]="DoubleQuotes",e[e.Tab=11]="Tab",e[e.NewLine=13]="NewLine",e[e.Space=32]="Space",e[e.ExclamationMark=33]="ExclamationMark",e[e.NumberSign=35]="NumberSign",e[e.DollarSign=36]="DollarSign",e[e.Ampersand=38]="Ampersand",e[e.SingleQuote=39]="SingleQuote",e[e.OpenParen=40]="OpenParen",e[e.CloseParen=41]="CloseParen",e[e.Asterisk=42]="Asterisk",e[e.PlusSign=43]="PlusSign",e[e.Comma=44]="Comma",e[e.MinusSign=45]="MinusSign",e[e.Period=46]="Period",e[e.Colon=58]="Colon",e[e.SemiColon=59]="SemiColon",e[e.LessThan=60]="LessThan",e[e.EqualSign=61]="EqualSign",e[e.GreaterThan=62]="GreaterThan",e[e.QuestionMark=63]="QuestionMark",e[e.AtSymbol=64]="AtSymbol",e[e.OpenBracket=91]="OpenBracket",e[e.Backslash=92]="Backslash",e[e.CloseBracket=93]="CloseBracket",e[e.Caret=94]="Caret",e[e.Underscore=95]="Underscore",e[e.BackQuote=96]="BackQuote",e[e.OpenBrace=123]="OpenBrace",e[e.Pipe=124]="Pipe",e[e.CloseBrace=125]="CloseBrace",e[e.Tilde=126]="Tilde",e[e.Undefined=-1]="Undefined"}(t.Type||(t.Type={}))},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){e.done?s(e.value):new n((function(t){t(e.value)})).then(o,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);let r=n(29);t.autoSpaceEnter=function(){return i(this,void 0,void 0,(function*(){let e=s.window.activeTextEditor;if(e){let t=e.selection.active,n=e.document.lineAt(t.line).text,i=r.parse(n),o="";0!==t.character&&((void 0===i[0].lineRoutines||0===i[0].lineRoutines.length)&&-1===n.indexOf(";")&&void 0!==i[0].lineIndentationArray&&i[0].lineIndentationArray.length>0?(i[0].lineIndentationArray.splice(-1),e.edit(e=>{e.replace(new s.Range(t.with(t.line,0),t.with(t.line,n.length)),r.render(i))})):(void 0===i[0].lineIndentationArray&&(i[0].lineIndentationArray=[]),function(e){let t=e.lineRoutines;if(t=e.lineRoutines)for(let e=0;e<t.length;e++)if(t[e].mRoutine.match(/(d|do)/i)&&!t[e].mArguments)return!0;return!1}(i[0])&&i[0].lineIndentationArray.push(" "),i[0].lineRoutines=[],delete i[0].lineComment,delete i[0].lineLabel,o=r.render(i))),e.edit(e=>{e.insert(t,"\n"+o)})}}))},t.autoSpaceTab=function(){return i(this,void 0,void 0,(function*(){let e=s.window.activeTextEditor;if(e){let t=e.selection.active,n=e.document.lineAt(t.line).text,i=r.parse(n);(null===i[0].lineRoutines||0===i[0].lineRoutines.length)&&-1===n.indexOf(";")&&null!==i[0].lineIndentationArray&&i[0].lineIndentationArray.length>0?(i[0].lineIndentationArray.push(" "),e.edit(e=>{" "===n.charAt(t.character-1)?e.insert(t.with(t.line,t.character),". "):e.insert(t.with(t.line,t.character)," . ")})):e.edit(e=>{e.insert(t,"\t")})}}))}},function(e,t,n){"use strict";var i=n(30),s=n(31);function r(e){var t={};return t=i.extractLabel(e,t),t=i.extractComment(t.lineExpression,t),t=i.extractIndentation(t.lineExpression,t),delete(t=i.extractRoutines(t.lineExpression,t)).lineExpression,t}function o(e){var t="";return t=s.appendLabel(e,t),t=s.appendIndentation(e,t),t=s.appendRoutines(e,t),t=s.appendComment(e,t)}e.exports.parse=function(e){for(var t=(e=e.replace("\r","")).split("\n"),n=[],i=0;i<t.length;i++){var s=r(t[i]);s.lineNumber=i+1,n.push(s)}return n},e.exports.render=function(e){var t="",n=[];Array.isArray(e)?n=e:n.push(e);for(var i=0;i<n.length;i++){var s=o(n[i]);i===n.length-1?t+=s:t=t+s+"\n"}return t}},function(e,t,n){"use strict";function i(e){for(var t=[],n=0,i=0;i<=e.length;i++)" "===e[i]||"\t"===e[i]?e.substring(0,i).split('"').length%2!=0&&e.substring(i).split('"').length%2!=0&&(e.substring(n,i).length>0?t.push(e.substring(n,i)):0!==e.substring(n,i).length||" "!==e.substring(n-1,n)&&"\t"!==e.substring(n-1,n)||t.push(e.substring(n,i)),n=i+1):i===e.length&&(e.substring(n,i).length>0?t.push(e.substring(n,i)):i!==n||" "!==e.substring(i-1,i)&&"/t"!==e.substring(i-1,i)||t.push(""));return t}function s(e){for(var t=e,n=0;n<t.length;n++)if(t[n].mRoutine){var i=t[n].mRoutine.indexOf(":");i>-1&&(t[n].mPostConditional=t[n].mRoutine.substring(i+1),t[n].mRoutine=t[n].mRoutine.substring(0,i))}return t}e.exports.extractLabel=function(e,t){for(var n=0;n<=e.length;n++){if(" "!==e[n]&&"\t"!==e[n]){if(0===n){t.lineLabel=e.split(/[ \t]/,1)[0];for(var i=t.lineLabel.length;i<=e.length;i++){if(" "!==e[i]&&"\t"!==e[i]){t.lineLeadSpace=e.substring(t.lineLabel.length,i),t.lineExpression=e.substring(i);break}if(i===e.length-1){t.lineLeadSpace=e.substring(t.lineLabel.length),t.lineExpression="";break}}break}t.lineLeadSpace=e.substring(0,n),t.lineExpression=e.substring(n);break}if(n===e.length-1){t.lineLeadSpace=e,t.lineExpression="";break}}return t},e.exports.extractComment=function(e,t){if(e.search(";")>=0){for(var n=0;n<e.length;n++)if(";"===e[n]){if(e.substring(0,n).split('"').length%2!=0&&e.substring(n).split('"').length%2!=0){t.lineExpression=e.substring(0,n),t.lineComment=e.substring(n).substring(1);break}if(e.substring(0,n).replace("").split('"').length%2!=0&&e.substring(n).split('"').length%2==0){t.lineExpression=e.substring(0,n),t.lineComment=e.substring(n).substring(1);break}t.lineExpression=e}return t}return t.lineExpression=e,t},e.exports.extractIndentation=function(e,t){for(var n=[],i=0,s=0,r=0,o=0;o<=e.length;o++)if("."===e[o])0!==i&&(r=o,n.push(e.substring(s,r))),s=o+1,i++;else{if("."!==e[o]&&" "!==e[o]&&"\t"!==e[o]){0!==i&&(r=o,n.push(e.substring(s,r)),t.lineExpression=e.substring(o));break}if(o===e.length-1){r=o+1,n.push(e.substring(s,r)),t.lineExpression=e.substring(o+1);break}}return n.length>0?t.lineIndentationArray=n:t.lineExpression=e,t},e.exports.splitRoutinesAndArguments=i,e.exports.extractPostConditional=s,e.exports.extractRoutines=function(e,t){for(var n={},r=[],o=i(e),a=0;a<o.length;){if(a%2==0)n.mRoutine=o[a];else{n.mArguments=o[a];for(var c=a+1;c<o.length&&""===o[c];)o.splice(c,1),n.mArguments=n.mArguments+" ";r.push(n),n={}}o.length%2!=0&&o.length>0&&a===o.length-1&&(n.mRoutine=o[a],r.push(n),n={}),a++}var u=s(r);return u.length>0&&(t.lineRoutines=u),t}},function(e,t,n){"use strict";e.exports.appendLabel=function(e,t){return e.lineLabel&&(t+=e.lineLabel),e.lineLeadSpace&&(t+=e.lineLeadSpace),t},e.exports.appendIndentation=function(e,t){var n="";if(e.lineIndentationArray&&e.lineIndentationArray.length>0){for(var i in e.lineIndentationArray)n=n+"."+e.lineIndentationArray[i];t+=n}return t},e.exports.appendRoutines=function(e,t){if(e.lineRoutines)for(var n in e.lineRoutines)(e.lineRoutines[n].mRoutine||""===e.lineRoutines[n].mRoutine)&&("0"===n?t+=e.lineRoutines[n].mRoutine:t=t+" "+e.lineRoutines[n].mRoutine,e.lineRoutines[n].mPostConditional&&(t=t+":"+e.lineRoutines[n].mPostConditional),e.lineRoutines[n].hasOwnProperty("mArguments")&&(t=t+" "+e.lineRoutines[n].mArguments));return t},e.exports.appendComment=function(e,t){return e.hasOwnProperty("lineComment")&&(t=t+";"+e.lineComment),t}}]);
//# sourceMappingURL=extension.js.map